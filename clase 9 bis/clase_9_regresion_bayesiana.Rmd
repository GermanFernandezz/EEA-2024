---
title: "Regresión Bayesiana"
author: "Juan Barriola, Azul Villanueva y Franco Mastelli"
date: "15 de Octubre de 2022"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
---

<style type="text/css">
div.main-container {
  max-width: 1600px;
  margin-left: auto;
  margin-right: auto;
}
</style>


# Datasets 


```{r, message=FALSE}
# Carga de librerías
library(tidyverse)
library(tidymodels)
library(brms)
library(GGally)
```

```{r}
salarios_nba = read_csv("salarios_nba_2023.csv") 
estadisticas_por_partido_nba = read_csv("estadisticas_por_partido_nba_2022.csv")

nba_salarios_estadisticas_partido = salarios_nba %>% 
                            inner_join(y=estadisticas_por_partido_nba, on=jugador) %>% 
                            drop_na()

```
# Analisis exploratorios

```{r}
nba_salarios_estadisticas_partido %>% 
  select(salario, Age, PTS, GS, DRB, TRB, AST, BLK) %>% 
  ggpairs(upper = list(continuous = wrap("cor", size = 3, hjust=0.5)), progress=FALSE) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "bottom") + 
  theme_bw()
```

# Modelo lineal clásico


```{r}
modelo_simple_puntos = lm(data = nba_salarios_estadisticas_partido, formula = salario ~ PTS)
```

```{r}
tidy(modelo_simple_puntos)
```
```{r}
glance(modelo_simple_puntos)
```
# Modelo Bayesiano

https://michael-franke.github.io/intro-data-analysis/simple-linear-regression-with-brms.html

```{r}
fit_salario<- brm(
  # specify what to explain in terms of what
  #  using the formula syntax
  formula = salario ~ PTS,
  # which data to use
  data = nba_salarios_estadisticas_partido
)
```
```{r}
summary(fit_salario)
```

```{r}

lista_stan = list(n = nrow(estadisticas_por_partido_nba),
                  p = 2,
                  y = nba_salarios_estadisticas_partido$salario,
                  x = nba_salarios_estadisticas_partido$PTS)
```


https://paul-buerkner.github.io/brms/
https://github.com/rmcelreath/rethinking

Compile the stan model

```{r}
li
modelo<-stan_model("regresion_simple_puntos.stan")
class(modelo)
#modelo
archivo<-"Bayesian Statistic with Rstan Weight at Birth.stan"
stan_code <- readChar(archivo, file.info(archivo)$size)
```

Run the model

```{r}
options(nC.cores=4)
ajuste<-stan(model_code = stan_code, data = dat,
                chains = 3, iter = 4000, warmup = 1000, thin = 1)

